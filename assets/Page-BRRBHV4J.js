import{j as e}from"./index-xfnGEtuL.js";import{R as t}from"./RedditPostRenderer-DAZRIZZK.js";import"./index-BaNn5-RR.js";const a=JSON.parse(`[{"kind":"Listing","data":{"after":null,"dist":1,"modhash":"","geo_filter":"","children":[{"kind":"t3","data":{"approved_at_utc":null,"subreddit":"LocalLLaMA","selftext":"...So this idea I had, I never could quite execute on, I thought I'd share and let people pick it apart, and/or take it to the next level. Here is how I got there.\\n\\nI have it in my mind that Llama 3.3 70b 8 bit should be close to Llama 4 Maverick 4-Bit at \\\\~243 GB). Llama 3.3 70b 8 bit is \\\\~75 GB and Llama 3.3 70b 4 bit is \\\\~43 GB. That's 118 GB  which is far less than Maverick, and yet 8 bit probably outperforms Scout 4 bit... so ... all I have to do is run Llama 3.3. 70b 4bit in VRAM as the draft model and have Llama 3.3 70b 8bit primarily in RAM... supposedly the variation between 4 bit to 8 bit isn't that meaningful... supposedly. Guess we should define meaningful. I always assumed it meant it basically kept in line with the original model with just a few words being different. \\n\\nApparently we're only talking outcome and not word for word equivalence. Turns out in practice I could never get the thing going at a speed that surpassed Llama 3.3 70 8bit split across VRAM and RAM by any meaningful amount. Probably because the models diverge too quickly word wise to be a meaningful speculative model. \\n\\nOkay... still... the old adage has been that a larger quantize model should outperform a smaller unquantitized model. So I was sure I'd have a more impressive speed boost than just using Llama 3.2 3b 8 bit at \\\\~4 GB with speculative decoding... especially since Llama 3.3 70b supposedly had similar performance to Llama 3.1 405b.\\n\\nStill... I'm curious if anyone else has tried this and how successful they were. Could this idea create a better alternative locally for single users than bloated MOE models? Perhaps tweaked in some way... for example perhaps we could build a front end that instead of trying to predict the exact words via speculative decoding, it just asked the 8-bit model to bless the output of 4-bit model sentence by sentence (With a prompt that asks would you have written the last sentence return true or false... or should the last sentence be changed). Perhaps there is a fun math shortcut that would let us use quantized dense models to generate speed similar to MoEs in speed but more dense. Holy grail for me is if we find a way to condense MoEs with minimal power expenditure, but that seems unlikely (outside of quantization which still feels woefully ineffective). \\n\\nSo there it is. I did my part. I shared what I thought was brilliance (and clearly wasn't) and maybe someone can shine a little light on how it could go better for a future me or you.\\n\\n:I feel all the comments will be quoting Billy Madison, \\"What you've just said is one of the most insanely idiotic things I have ever heard. At no point in your rambling, incoherent response were you even close to anything that could be considered a rational thought. Everyone in this room is now dumber for having listened to it. I award you no points, and may God have mercy on your soul.\\"","user_reports":[],"saved":false,"mod_reason_title":null,"gilded":0,"clicked":false,"title":"Speculative Decoding and Quantization ... I'm probably not going anywhere near what you think...","link_flair_richtext":[{"e":"text","t":"Discussion"}],"subreddit_name_prefixed":"r/LocalLLaMA","hidden":false,"pwls":6,"link_flair_css_class":"","downs":0,"thumbnail_height":null,"top_awarded_type":null,"hide_score":false,"name":"t3_1lq9eg5","quarantine":false,"link_flair_text_color":"light","upvote_ratio":0.5,"author_flair_background_color":null,"subreddit_type":"public","ups":0,"total_awards_received":0,"media_embed":{},"thumbnail_width":null,"author_flair_template_id":null,"is_original_content":false,"author_fullname":"t2_dissgzyl","secure_media":null,"is_reddit_media_domain":false,"is_meta":false,"category":null,"secure_media_embed":{},"link_flair_text":"Discussion","can_mod_post":false,"score":0,"approved_by":null,"is_created_from_ads_ui":false,"author_premium":false,"thumbnail":"self","edited":false,"author_flair_css_class":null,"author_flair_richtext":[],"gildings":{},"content_categories":null,"is_self":true,"mod_note":null,"created":1751495536,"link_flair_type":"richtext","wls":6,"removed_by_category":null,"banned_by":null,"author_flair_type":"text","domain":"self.LocalLLaMA","allow_live_comments":false,"selftext_html":"&lt;!-- SC_OFF --&gt;&lt;div class=\\"md\\"&gt;&lt;p&gt;...So this idea I had, I never could quite execute on, I thought I&amp;#39;d share and let people pick it apart, and/or take it to the next level. Here is how I got there.&lt;/p&gt;\\n\\n&lt;p&gt;I have it in my mind that Llama 3.3 70b 8 bit should be close to Llama 4 Maverick 4-Bit at ~243 GB). Llama 3.3 70b 8 bit is ~75 GB and Llama 3.3 70b 4 bit is ~43 GB. That&amp;#39;s 118 GB  which is far less than Maverick, and yet 8 bit probably outperforms Scout 4 bit... so ... all I have to do is run Llama 3.3. 70b 4bit in VRAM as the draft model and have Llama 3.3 70b 8bit primarily in RAM... supposedly the variation between 4 bit to 8 bit isn&amp;#39;t that meaningful... supposedly. Guess we should define meaningful. I always assumed it meant it basically kept in line with the original model with just a few words being different. &lt;/p&gt;\\n\\n&lt;p&gt;Apparently we&amp;#39;re only talking outcome and not word for word equivalence. Turns out in practice I could never get the thing going at a speed that surpassed Llama 3.3 70 8bit split across VRAM and RAM by any meaningful amount. Probably because the models diverge too quickly word wise to be a meaningful speculative model. &lt;/p&gt;\\n\\n&lt;p&gt;Okay... still... the old adage has been that a larger quantize model should outperform a smaller unquantitized model. So I was sure I&amp;#39;d have a more impressive speed boost than just using Llama 3.2 3b 8 bit at ~4 GB with speculative decoding... especially since Llama 3.3 70b supposedly had similar performance to Llama 3.1 405b.&lt;/p&gt;\\n\\n&lt;p&gt;Still... I&amp;#39;m curious if anyone else has tried this and how successful they were. Could this idea create a better alternative locally for single users than bloated MOE models? Perhaps tweaked in some way... for example perhaps we could build a front end that instead of trying to predict the exact words via speculative decoding, it just asked the 8-bit model to bless the output of 4-bit model sentence by sentence (With a prompt that asks would you have written the last sentence return true or false... or should the last sentence be changed). Perhaps there is a fun math shortcut that would let us use quantized dense models to generate speed similar to MoEs in speed but more dense. Holy grail for me is if we find a way to condense MoEs with minimal power expenditure, but that seems unlikely (outside of quantization which still feels woefully ineffective). &lt;/p&gt;\\n\\n&lt;p&gt;So there it is. I did my part. I shared what I thought was brilliance (and clearly wasn&amp;#39;t) and maybe someone can shine a little light on how it could go better for a future me or you.&lt;/p&gt;\\n\\n&lt;p&gt;:I feel all the comments will be quoting Billy Madison, &amp;quot;What you&amp;#39;ve just said is one of the most insanely idiotic things I have ever heard. At no point in your rambling, incoherent response were you even close to anything that could be considered a rational thought. Everyone in this room is now dumber for having listened to it. I award you no points, and may God have mercy on your soul.&amp;quot;&lt;/p&gt;\\n&lt;/div&gt;&lt;!-- SC_ON --&gt;","likes":null,"suggested_sort":null,"banned_at_utc":null,"view_count":null,"archived":false,"no_follow":true,"is_crosspostable":false,"pinned":false,"over_18":false,"all_awardings":[],"awarders":[],"media_only":false,"link_flair_template_id":"5f921ea4-c7bc-11ed-9c23-3a00622979b4","can_gild":false,"spoiler":false,"locked":false,"author_flair_text":null,"treatment_tags":[],"visited":false,"removed_by":null,"num_reports":null,"distinguished":null,"subreddit_id":"t5_81eyvm","author_is_blocked":false,"mod_reason_by":null,"removal_reason":null,"link_flair_background_color":"#646d73","id":"1lq9eg5","is_robot_indexable":true,"num_duplicates":0,"report_reasons":null,"author":"silenceimpaired","discussion_type":null,"num_comments":8,"send_replies":true,"media":null,"contest_mode":false,"author_patreon_flair":false,"author_flair_text_color":null,"permalink":"/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/","stickied":false,"url":"https://www.reddit.com/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/","subreddit_subscribers":494198,"created_utc":1751495536,"num_crossposts":0,"mod_reports":[],"is_video":false}}],"before":null}},{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"richtext","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":"ed89e5c6-72f1-11ee-9954-1697022cd89d","likes":null,"replies":{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":"","user_reports":[],"saved":false,"id":"n13gjkg","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"no_witty_username","can_mod_post":false,"created_utc":1751533348,"send_replies":true,"parent_id":"t1_n10yl88","score":2,"author_fullname":"t2_4j2nc","removal_reason":null,"approved_by":null,"mod_note":null,"all_awardings":[],"body":"Seems that mixture of grouped experts models are trying to rectify that.","edited":false,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n13gjkg","is_submitter":false,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;Seems that mixture of grouped experts models are trying to rectify that.&lt;/p&gt;\\n&lt;/div&gt;","gildings":{},"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"link_id":"t3_1lq9eg5","unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/n13gjkg/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751533348,"author_flair_text":null,"treatment_tags":[],"collapsed":false,"subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":1,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":2}}],"before":null}},"user_reports":[],"saved":false,"id":"n10yl88","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":false,"author":"ThinkExtension2328","can_mod_post":false,"created_utc":1751496017,"send_replies":true,"parent_id":"t3_1lq9eg5","score":6,"author_fullname":"t2_8eneodlk","approved_by":null,"mod_note":null,"all_awardings":[],"collapsed":false,"body":"In my opinion all current models are structured wrong, if you ask me all models should be structured like Russian dolls. \\n\\nSo basically the 2b and the 14b  models should all be one singular model. The 2b model should be running always as an inner draft model then the 14b should be used to verify and edit if required. \\n\\nBasically take this idea and scale it up and down as you wish. This way even a 70b model can run at 2b speeds when the query is not complex.","edited":false,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n10yl88","is_submitter":false,"downs":0,"author_flair_richtext":[{"e":"text","t":"llama.cpp"}],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;In my opinion all current models are structured wrong, if you ask me all models should be structured like Russian dolls. &lt;/p&gt;\\n\\n&lt;p&gt;So basically the 2b and the 14b  models should all be one singular model. The 2b model should be running always as an inner draft model then the 14b should be used to verify and edit if required. &lt;/p&gt;\\n\\n&lt;p&gt;Basically take this idea and scale it up and down as you wish. This way even a 70b model can run at 2b speeds when the query is not complex.&lt;/p&gt;\\n&lt;/div&gt;","removal_reason":null,"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"gildings":{},"unrepliable_reason":null,"author_flair_text_color":"light","score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/n10yl88/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751496017,"author_flair_text":"llama.cpp","treatment_tags":[],"link_id":"t3_1lq9eg5","subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":0,"author_flair_background_color":"#bbbdbf","collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":6}},{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":"","user_reports":[],"saved":false,"id":"n11dbcm","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"Conscious_Cut_6144","can_mod_post":false,"send_replies":true,"parent_id":"t1_n11c4zr","score":2,"author_fullname":"t2_9hl4ymvj","removal_reason":null,"approved_by":null,"mod_note":null,"all_awardings":[],"body":"Good thinking but actually no.  \\nLet's tweak the example:  \\n  \\nspec model predicts 956 instead of 456  \\nIf you are just checking the last token, your big model would still predict 6  \\nBut the big model never gets the chance to correct the 1st token, even though the big model knew the correct token was a 4","edited":false,"top_awarded_type":null,"downs":0,"author_flair_css_class":null,"name":"t1_n11dbcm","is_submitter":false,"collapsed":false,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;Good thinking but actually no.&lt;br/&gt;\\nLet&amp;#39;s tweak the example:  &lt;/p&gt;\\n\\n&lt;p&gt;spec model predicts 956 instead of 456&lt;br/&gt;\\nIf you are just checking the last token, your big model would still predict 6&lt;br/&gt;\\nBut the big model never gets the chance to correct the 1st token, even though the big model knew the correct token was a 4&lt;/p&gt;\\n&lt;/div&gt;","gildings":{},"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"link_id":"t3_1lq9eg5","unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/n11dbcm/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751500841,"author_flair_text":null,"treatment_tags":[],"created_utc":1751500841,"subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":2,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":2}}],"before":null}},"user_reports":[],"saved":false,"id":"n11c4zr","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"silenceimpaired","can_mod_post":false,"created_utc":1751500464,"send_replies":true,"parent_id":"t1_n11bmc9","score":1,"author_fullname":"t2_dissgzyl","removal_reason":null,"approved_by":null,"mod_note":null,"all_awardings":[],"body":"Hmm wonder if you could skip straight to the last compute to compare against what is expected.","edited":false,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n11c4zr","is_submitter":true,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;Hmm wonder if you could skip straight to the last compute to compare against what is expected.&lt;/p&gt;\\n&lt;/div&gt;","gildings":{},"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"link_id":"t3_1lq9eg5","unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/n11c4zr/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751500464,"author_flair_text":null,"treatment_tags":[],"collapsed":false,"subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":1,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":1}}],"before":null}},"user_reports":[],"saved":false,"id":"n11bmc9","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"Conscious_Cut_6144","can_mod_post":false,"created_utc":1751500301,"send_replies":true,"parent_id":"t3_1lq9eg5","score":3,"author_fullname":"t2_9hl4ymvj","approved_by":null,"mod_note":null,"all_awardings":[],"collapsed":false,"body":"spec decoding works because you have an abundance of compute available (in nvidia gpus for example)  \\nWhen running on CPU, it can actually slows you down.\\n\\nHere a simple explanation of how this works:\\n\\nyou have the following 3 tokens:  \\n1 2 3  \\nyour 4 bit speculative model predicts the next 3 tokens are:  \\n4 5 6\\n\\nNow your 8 bit model does the following 4 computations all at the same time:  \\n1 2 3 ?  \\n1 2 3 4 ?  \\n1 2 3 4 5 ?  \\n1 2 3 4 5 6 ?  \\nBy doing them at the same time you only use 1x your memory bandwidth, but still need the full 4x compute.\\n\\nNow if the speculative model was correct you suddenly jump from 123 to 1234567\\n\\nHowever this only works with a gpu that has enough compute to do 4 calculations all at once.  \\nOn a CPU you are often compute bound, and if you try to throw spec decoding in the mix, you will be very compute bound.","edited":false,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n11bmc9","is_submitter":false,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;spec decoding works because you have an abundance of compute available (in nvidia gpus for example)&lt;br/&gt;\\nWhen running on CPU, it can actually slows you down.&lt;/p&gt;\\n\\n&lt;p&gt;Here a simple explanation of how this works:&lt;/p&gt;\\n\\n&lt;p&gt;you have the following 3 tokens:&lt;br/&gt;\\n1 2 3&lt;br/&gt;\\nyour 4 bit speculative model predicts the next 3 tokens are:&lt;br/&gt;\\n4 5 6&lt;/p&gt;\\n\\n&lt;p&gt;Now your 8 bit model does the following 4 computations all at the same time:&lt;br/&gt;\\n1 2 3 ?&lt;br/&gt;\\n1 2 3 4 ?&lt;br/&gt;\\n1 2 3 4 5 ?&lt;br/&gt;\\n1 2 3 4 5 6 ?&lt;br/&gt;\\nBy doing them at the same time you only use 1x your memory bandwidth, but still need the full 4x compute.&lt;/p&gt;\\n\\n&lt;p&gt;Now if the speculative model was correct you suddenly jump from 123 to 1234567&lt;/p&gt;\\n\\n&lt;p&gt;However this only works with a gpu that has enough compute to do 4 calculations all at once.&lt;br/&gt;\\nOn a CPU you are often compute bound, and if you try to throw spec decoding in the mix, you will be very compute bound.&lt;/p&gt;\\n&lt;/div&gt;","removal_reason":null,"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"gildings":{},"unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/n11bmc9/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751500301,"author_flair_text":null,"treatment_tags":[],"link_id":"t3_1lq9eg5","subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":0,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":3}},{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":"","user_reports":[],"saved":false,"id":"n11q22f","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"DeProgrammer99","can_mod_post":false,"created_utc":1751504977,"send_replies":true,"parent_id":"t3_1lq9eg5","score":2,"author_fullname":"t2_w4j8t","approved_by":null,"mod_note":null,"all_awardings":[],"collapsed":false,"body":"I did try using a model's heavily quantized version as the draft model for the heck of it with a 8B model.\\n\\nDeepSeek-R1-0528-Qwen3-8B-UD-Q**6**\\\\_K\\\\_XL + UD-IQ**1**\\\\_S: 1.7% faster, and the acceptance rate was only 23/1970 so it's surprising there was any speed improvement at all.\\n\\nDeepSeek-R1-0528-Qwen3-8B-UD-Q**6**\\\\_K\\\\_XL + UD-Q**2**\\\\_K\\\\_XL: 29% faster, and the acceptance rate was only 90/2011 (yet it produced 12% fewer tokens total, although I had temperature set to 0)\\n\\n[Martin](https://github.com/SciSharp/LLamaSharp/commits?author=martindevans) brought up some papers when I did that since I was spamming the LlamaSharp discord with my nonsense:\\n\\n&gt;looks like there's been research into this:\\n\\n&gt;[FlexiDepth](https://arxiv.org/abs/2503.23798) adaptively skips layers in an unmodified Llama-3-8b and claims no drop in benchmark perf,\\n\\n&gt;[Layer Skip](https://x.com/AIatMeta/status/1851327605716435011) seems to be a modified version of llama 2 that skips layers ([paper](https://arxiv.org/abs/2404.16710)),\\n\\n&gt;[AdaSkip](https://ojs.aaai.org/index.php/AAAI/article/view/34579),\\n\\n&gt;still reading the full paper, but LayerSkip looks something like what I was talking about. It stops early, but then they use the later layers to check the speculated tokens. So it's self speculation, with no accuracy loss, no extra memory used for weights, and even a unified KV cache!","edited":1751505223,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n11q22f","is_submitter":false,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;I did try using a model&amp;#39;s heavily quantized version as the draft model for the heck of it with a 8B model.&lt;/p&gt;\\n\\n&lt;p&gt;DeepSeek-R1-0528-Qwen3-8B-UD-Q&lt;strong&gt;6&lt;/strong&gt;_K_XL + UD-IQ&lt;strong&gt;1&lt;/strong&gt;_S: 1.7% faster, and the acceptance rate was only 23/1970 so it&amp;#39;s surprising there was any speed improvement at all.&lt;/p&gt;\\n\\n&lt;p&gt;DeepSeek-R1-0528-Qwen3-8B-UD-Q&lt;strong&gt;6&lt;/strong&gt;_K_XL + UD-Q&lt;strong&gt;2&lt;/strong&gt;_K_XL: 29% faster, and the acceptance rate was only 90/2011 (yet it produced 12% fewer tokens total, although I had temperature set to 0)&lt;/p&gt;\\n\\n&lt;p&gt;&lt;a href=\\"https://github.com/SciSharp/LLamaSharp/commits?author=martindevans\\"&gt;Martin&lt;/a&gt; brought up some papers when I did that since I was spamming the LlamaSharp discord with my nonsense:&lt;/p&gt;\\n\\n&lt;blockquote&gt;\\n&lt;p&gt;looks like there&amp;#39;s been research into this:&lt;/p&gt;\\n\\n&lt;p&gt;&lt;a href=\\"https://arxiv.org/abs/2503.23798\\"&gt;FlexiDepth&lt;/a&gt; adaptively skips layers in an unmodified Llama-3-8b and claims no drop in benchmark perf,&lt;/p&gt;\\n\\n&lt;p&gt;&lt;a href=\\"https://x.com/AIatMeta/status/1851327605716435011\\"&gt;Layer Skip&lt;/a&gt; seems to be a modified version of llama 2 that skips layers (&lt;a href=\\"https://arxiv.org/abs/2404.16710\\"&gt;paper&lt;/a&gt;),&lt;/p&gt;\\n\\n&lt;p&gt;&lt;a href=\\"https://ojs.aaai.org/index.php/AAAI/article/view/34579\\"&gt;AdaSkip&lt;/a&gt;,&lt;/p&gt;\\n\\n&lt;p&gt;still reading the full paper, but LayerSkip looks something like what I was talking about. It stops early, but then they use the later layers to check the speculated tokens. So it&amp;#39;s self speculation, with no accuracy loss, no extra memory used for weights, and even a unified KV cache!&lt;/p&gt;\\n&lt;/blockquote&gt;\\n&lt;/div&gt;","removal_reason":null,"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"gildings":{},"unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/n11q22f/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751504977,"author_flair_text":null,"treatment_tags":[],"link_id":"t3_1lq9eg5","subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":0,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":2}},{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":"","user_reports":[],"saved":false,"id":"n10x792","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"silenceimpaired","can_mod_post":false,"created_utc":1751495561,"send_replies":true,"parent_id":"t3_1lq9eg5","score":1,"author_fullname":"t2_dissgzyl","approved_by":null,"mod_note":null,"all_awardings":[],"collapsed":false,"body":"In case you're confused with the quote: [https://www.youtube.com/watch?v=5hfYJsQAhl0](https://www.youtube.com/watch?v=5hfYJsQAhl0)","edited":false,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n10x792","is_submitter":true,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;In case you&amp;#39;re confused with the quote: &lt;a href=\\"https://www.youtube.com/watch?v=5hfYJsQAhl0\\"&gt;https://www.youtube.com/watch?v=5hfYJsQAhl0&lt;/a&gt;&lt;/p&gt;\\n&lt;/div&gt;","removal_reason":null,"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"gildings":{},"unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lq9eg5/speculative_decoding_and_quantization_im_probably/n10x792/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751495561,"author_flair_text":null,"treatment_tags":[],"link_id":"t3_1lq9eg5","subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":0,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":1}}],"before":null}}]`),s=()=>e.jsx(t,{data:a});export{s as default};
