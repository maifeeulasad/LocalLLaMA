import{j as e}from"./index-CNyNkRpk.js";import{R as t}from"./RedditPostRenderer-Dza0u9i2.js";import"./index-BUchu_-K.js";const a=JSON.parse(`[{"kind":"Listing","data":{"after":null,"dist":1,"modhash":"","geo_filter":"","children":[{"kind":"t3","data":{"approved_at_utc":null,"subreddit":"LocalLLaMA","selftext":"I am using InternVL an image task - and further plan on fine tuning it for the task.\\n\\nI have a tight deadline and I want to optimize the latency of it. For the InternVL 3 2B model; it takes about ~4 seconds to come up with a response in a L4 GPU set up. \\nI did try vLLM but the benchmarking results show a decrease in the performance  - accuracy(also came across a few articles that share the same concern). I don’t want to quantize the model as it is already a very small model and might result in a drop of the performance.\\n\\nI am using the LMDeploy framework for the same. Any suggestions on how I can further reduce the latency? ","user_reports":[],"saved":false,"mod_reason_title":null,"gilded":0,"clicked":false,"title":"Optimize Latency of InternVL","link_flair_richtext":[{"e":"text","t":"Question | Help"}],"subreddit_name_prefixed":"r/LocalLLaMA","hidden":false,"pwls":6,"link_flair_css_class":"","downs":0,"thumbnail_height":null,"top_awarded_type":null,"hide_score":false,"name":"t3_1lppxs2","quarantine":false,"link_flair_text_color":"dark","upvote_ratio":0.67,"author_flair_background_color":null,"subreddit_type":"public","ups":1,"total_awards_received":0,"media_embed":{},"thumbnail_width":null,"author_flair_template_id":null,"is_original_content":false,"author_fullname":"t2_7xzfnec0","secure_media":null,"is_reddit_media_domain":false,"is_meta":false,"category":null,"secure_media_embed":{},"link_flair_text":"Question | Help","can_mod_post":false,"score":1,"approved_by":null,"is_created_from_ads_ui":false,"author_premium":false,"thumbnail":"self","edited":false,"author_flair_css_class":null,"author_flair_richtext":[],"gildings":{},"content_categories":null,"is_self":true,"mod_note":null,"created":1751442540,"link_flair_type":"richtext","wls":6,"removed_by_category":null,"banned_by":null,"author_flair_type":"text","domain":"self.LocalLLaMA","allow_live_comments":false,"selftext_html":"&lt;!-- SC_OFF --&gt;&lt;div class=\\"md\\"&gt;&lt;p&gt;I am using InternVL an image task - and further plan on fine tuning it for the task.&lt;/p&gt;\\n\\n&lt;p&gt;I have a tight deadline and I want to optimize the latency of it. For the InternVL 3 2B model; it takes about ~4 seconds to come up with a response in a L4 GPU set up. \\nI did try vLLM but the benchmarking results show a decrease in the performance  - accuracy(also came across a few articles that share the same concern). I don’t want to quantize the model as it is already a very small model and might result in a drop of the performance.&lt;/p&gt;\\n\\n&lt;p&gt;I am using the LMDeploy framework for the same. Any suggestions on how I can further reduce the latency? &lt;/p&gt;\\n&lt;/div&gt;&lt;!-- SC_ON --&gt;","likes":null,"suggested_sort":null,"banned_at_utc":null,"view_count":null,"archived":false,"no_follow":true,"is_crosspostable":false,"pinned":false,"over_18":false,"all_awardings":[],"awarders":[],"media_only":false,"link_flair_template_id":"2c9831e6-bf92-11ed-98e6-d2b8bcc02ae1","can_gild":false,"spoiler":false,"locked":false,"author_flair_text":null,"treatment_tags":[],"visited":false,"removed_by":null,"num_reports":null,"distinguished":null,"subreddit_id":"t5_81eyvm","author_is_blocked":false,"mod_reason_by":null,"removal_reason":null,"link_flair_background_color":"#5a74cc","id":"1lppxs2","is_robot_indexable":true,"num_duplicates":0,"report_reasons":null,"author":"chitrabhat4","discussion_type":null,"num_comments":5,"send_replies":true,"media":null,"contest_mode":false,"author_patreon_flair":false,"author_flair_text_color":null,"permalink":"/r/LocalLLaMA/comments/1lppxs2/optimize_latency_of_internvl/","stickied":false,"url":"https://www.reddit.com/r/LocalLLaMA/comments/1lppxs2/optimize_latency_of_internvl/","subreddit_subscribers":494001,"created_utc":1751442540,"num_crossposts":0,"mod_reports":[],"is_video":false}}],"before":null}},{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"likes":null,"replies":{"kind":"Listing","data":{"after":null,"dist":null,"modhash":"","geo_filter":"","children":[{"kind":"t1","data":{"subreddit_id":"t5_81eyvm","approved_at_utc":null,"author_is_blocked":false,"comment_type":null,"awarders":[],"mod_reason_by":null,"banned_by":null,"author_flair_type":"text","total_awards_received":0,"subreddit":"LocalLLaMA","author_flair_template_id":null,"distinguished":null,"likes":null,"replies":"","user_reports":[],"saved":false,"id":"n13wmmx","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"FullOf_Bad_Ideas","can_mod_post":false,"send_replies":true,"parent_id":"t1_n12xm7b","score":1,"author_fullname":"t2_9s7pmakgx","removal_reason":null,"approved_by":null,"mod_note":null,"all_awardings":[],"body":"Yeah, it's qwen backbone but ViT and mm projector is different, so prefill has different performance characteristics that impact prompt processing throughput.\\n\\n4 secons for 2k prefill and 2k decode for 2B model is a very very low latency already. Given that decode is bandwidth limited, that's way faster than I expected it to be - 4GB weights at BF16 with 300GB/s bandwidth give you 75 t/s maximum token generation speed, assuming perfect utilization that never happens, so 27 seconds to generate 2k tokens. I don't see how the number that you gave me could be true unless you're mixing up various metrics. You can use FP8 online quants with minimal accuracy degradation and you can look into n-gram speculative decoding, but otherwise I don't think that's 4s end-to-end latency is achievable here, assuming that it's actually 2k tokens in and 2k tokens out.","edited":false,"author_flair_css_class":null,"name":"t1_n13wmmx","is_submitter":false,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;Yeah, it&amp;#39;s qwen backbone but ViT and mm projector is different, so prefill has different performance characteristics that impact prompt processing throughput.&lt;/p&gt;\\n\\n&lt;p&gt;4 secons for 2k prefill and 2k decode for 2B model is a very very low latency already. Given that decode is bandwidth limited, that&amp;#39;s way faster than I expected it to be - 4GB weights at BF16 with 300GB/s bandwidth give you 75 t/s maximum token generation speed, assuming perfect utilization that never happens, so 27 seconds to generate 2k tokens. I don&amp;#39;t see how the number that you gave me could be true unless you&amp;#39;re mixing up various metrics. You can use FP8 online quants with minimal accuracy degradation and you can look into n-gram speculative decoding, but otherwise I don&amp;#39;t think that&amp;#39;s 4s end-to-end latency is achievable here, assuming that it&amp;#39;s actually 2k tokens in and 2k tokens out.&lt;/p&gt;\\n&lt;/div&gt;","gildings":{},"collapsed_reason":null,"link_id":"t3_1lppxs2","associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"top_awarded_type":null,"unrepliable_reason":null,"author_flair_text_color":null,"treatment_tags":[],"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lppxs2/optimize_latency_of_internvl/n13wmmx/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751541831,"author_flair_text":null,"collapsed":false,"created_utc":1751541831,"subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":4,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":1}}],"before":null}},"user_reports":[],"saved":false,"id":"n12xm7b","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"chitrabhat4","can_mod_post":false,"send_replies":true,"parent_id":"t1_n0yh82d","score":1,"author_fullname":"t2_7xzfnec0","removal_reason":null,"approved_by":null,"mod_note":null,"all_awardings":[],"collapsed":false,"body":"By latency I mean the total time it takes to finish generating. I’ve benchmarked the Qwen 2.5 3b model and found that the accuracy isn’t great. InternVL has outperformed Qwen on object detection tasks - from what I understand the language backbone of internVL is still Qwen.","edited":false,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n12xm7b","is_submitter":true,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;By latency I mean the total time it takes to finish generating. I’ve benchmarked the Qwen 2.5 3b model and found that the accuracy isn’t great. InternVL has outperformed Qwen on object detection tasks - from what I understand the language backbone of internVL is still Qwen.&lt;/p&gt;\\n&lt;/div&gt;","gildings":{},"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"link_id":"t3_1lppxs2","unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lppxs2/optimize_latency_of_internvl/n12xm7b/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751522607,"author_flair_text":null,"treatment_tags":[],"created_utc":1751522607,"subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":3,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":1}}],"before":null}},"user_reports":[],"saved":false,"id":"n0yh82d","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"FullOf_Bad_Ideas","can_mod_post":false,"send_replies":true,"parent_id":"t1_n0y8z8m","score":1,"author_fullname":"t2_9s7pmakgx","removal_reason":null,"approved_by":null,"mod_note":null,"all_awardings":[],"body":"When you mean latency, do you mean latency to the first token or total time you need to wait for response to finish generating?\\n\\nCheck if Qwen 2 VL 2B in SGLang/vLLM gives you any better TTFT, I had issues with slow prefill in Internvl3 but that was on versions that have bigger ViTs, not on the small ones.\\n\\nIf that doesn't fix it, I think you'll need to move up in GPUs - L4 has slow VRAM and it will really limit how fast you can inference a model, you'll need something with faster VRAM. Enterprise grade GPUs from 2020 like A100 have 1.5 TB/s bandwidth, L4 has 0.3 TB/s, it's not enough for latency-sensitive usecase imo.","edited":false,"top_awarded_type":null,"downs":0,"author_flair_css_class":null,"name":"t1_n0yh82d","is_submitter":false,"collapsed":false,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;When you mean latency, do you mean latency to the first token or total time you need to wait for response to finish generating?&lt;/p&gt;\\n\\n&lt;p&gt;Check if Qwen 2 VL 2B in SGLang/vLLM gives you any better TTFT, I had issues with slow prefill in Internvl3 but that was on versions that have bigger ViTs, not on the small ones.&lt;/p&gt;\\n\\n&lt;p&gt;If that doesn&amp;#39;t fix it, I think you&amp;#39;ll need to move up in GPUs - L4 has slow VRAM and it will really limit how fast you can inference a model, you&amp;#39;ll need something with faster VRAM. Enterprise grade GPUs from 2020 like A100 have 1.5 TB/s bandwidth, L4 has 0.3 TB/s, it&amp;#39;s not enough for latency-sensitive usecase imo.&lt;/p&gt;\\n&lt;/div&gt;","gildings":{},"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"link_id":"t3_1lppxs2","unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lppxs2/optimize_latency_of_internvl/n0yh82d/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751469792,"author_flair_text":null,"treatment_tags":[],"created_utc":1751469792,"subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":2,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":1}}],"before":null}},"user_reports":[],"saved":false,"id":"n0y8z8m","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"chitrabhat4","can_mod_post":false,"created_utc":1751467448,"send_replies":true,"parent_id":"t1_n0y75s2","score":1,"author_fullname":"t2_7xzfnec0","removal_reason":null,"approved_by":null,"mod_note":null,"all_awardings":[],"body":"I am expecting somewhere around 2k decode tokens and pre fill is also somewhere around the same.\\nPreferably batch processing - I’ll be processing somewhere around 10-20 images per batch.","edited":false,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n0y8z8m","is_submitter":true,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;I am expecting somewhere around 2k decode tokens and pre fill is also somewhere around the same.\\nPreferably batch processing - I’ll be processing somewhere around 10-20 images per batch.&lt;/p&gt;\\n&lt;/div&gt;","gildings":{},"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"link_id":"t3_1lppxs2","unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lppxs2/optimize_latency_of_internvl/n0y8z8m/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751467448,"author_flair_text":null,"treatment_tags":[],"collapsed":false,"subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":1,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":1}}],"before":null}},"user_reports":[],"saved":false,"id":"n0y75s2","banned_at_utc":null,"mod_reason_title":null,"gilded":0,"archived":false,"collapsed_reason_code":null,"no_follow":true,"author":"FullOf_Bad_Ideas","can_mod_post":false,"created_utc":1751466926,"send_replies":true,"parent_id":"t3_1lppxs2","score":1,"author_fullname":"t2_9s7pmakgx","approved_by":null,"mod_note":null,"all_awardings":[],"collapsed":false,"body":"How much prefill tokens and decode tokens do you expect with each request? Will you be sending hundreds of requests or processing just one at the time?","edited":false,"top_awarded_type":null,"author_flair_css_class":null,"name":"t1_n0y75s2","is_submitter":false,"downs":0,"author_flair_richtext":[],"author_patreon_flair":false,"body_html":"&lt;div class=\\"md\\"&gt;&lt;p&gt;How much prefill tokens and decode tokens do you expect with each request? Will you be sending hundreds of requests or processing just one at the time?&lt;/p&gt;\\n&lt;/div&gt;","removal_reason":null,"collapsed_reason":null,"distinguished":null,"associated_award":null,"stickied":false,"author_premium":false,"can_gild":false,"gildings":{},"unrepliable_reason":null,"author_flair_text_color":null,"score_hidden":false,"permalink":"/r/LocalLLaMA/comments/1lppxs2/optimize_latency_of_internvl/n0y75s2/","subreddit_type":"public","locked":false,"report_reasons":null,"created":1751466926,"author_flair_text":null,"treatment_tags":[],"link_id":"t3_1lppxs2","subreddit_name_prefixed":"r/LocalLLaMA","controversiality":0,"depth":0,"author_flair_background_color":null,"collapsed_because_crowd_control":null,"mod_reports":[],"num_reports":null,"ups":1}}],"before":null}}]`),r=()=>e.jsx(t,{data:a});export{r as default};
