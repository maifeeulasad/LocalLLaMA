[
  {
    "kind": "Listing",
    "data": {
      "after": null,
      "dist": 1,
      "modhash": "",
      "geo_filter": "",
      "children": [
        {
          "kind": "t3",
          "data": {
            "approved_at_utc": null,
            "subreddit": "LocalLLaMA",
            "selftext": "[edit at the bottom cause i just had another thought]\n\nI just finished my RAG pipeline and got everything wired together, but i’m finding that i didn’t think through decisions on when to call the retriever vs. when to just let the LLM answer. I’m curious, how do others who’ve implemented a RAG pipeline decide when to actually call it? \n\nI started with just passing the prompt to a different model and saying some flavor of “decide if the below prompt requires RAG to answer or not” (with some better prompt engineering of course), but hardware is a big constraint for me at the moment so i’m trying to minimize LLM calls where i can. \n\nAfter that, i tried manually defining rules around what goes where. I think i’ll still end up doing this to some extent at the end of the pipeline as a catch all based on words that i know will require RAG (like mention of domain specific words in the prompt) \n\nCurrently, i’m thinking i’ll just build a classification model that decides whether or not to call the RAG pipeline using few shot prompting. i’m currently working through a training dataset for this right now, but am realizing that this may be a ton of work for something that may ultimately have an easier solution. \n\n\n[the new thought] instead of a classification model for whether or not to use rag, would it be smarter to use a classification model to tag *intention tagging* and then use rag based off that? for example, intention tag = context:general-knowledge or intention tag = fact-finding:domain-knowledge or something like that\n\n\n\n\n\n\nthoughts? ",
            "user_reports": [],
            "saved": false,
            "mod_reason_title": null,
            "gilded": 0,
            "clicked": false,
            "title": "When to RAG",
            "link_flair_richtext": [
              {
                "e": "text",
                "t": "Discussion"
              }
            ],
            "subreddit_name_prefixed": "r/LocalLLaMA",
            "hidden": false,
            "pwls": 6,
            "link_flair_css_class": "",
            "downs": 0,
            "thumbnail_height": null,
            "top_awarded_type": null,
            "hide_score": false,
            "name": "t3_1m2kz44",
            "quarantine": false,
            "link_flair_text_color": "light",
            "upvote_ratio": 0.75,
            "author_flair_background_color": null,
            "subreddit_type": "public",
            "ups": 4,
            "total_awards_received": 0,
            "media_embed": {},
            "thumbnail_width": null,
            "author_flair_template_id": null,
            "is_original_content": false,
            "author_fullname": "t2_1op55876",
            "secure_media": null,
            "is_reddit_media_domain": false,
            "is_meta": false,
            "category": null,
            "secure_media_embed": {},
            "link_flair_text": "Discussion",
            "can_mod_post": false,
            "score": 4,
            "approved_by": null,
            "is_created_from_ads_ui": false,
            "author_premium": false,
            "thumbnail": "self",
            "edited": 1752793784,
            "author_flair_css_class": null,
            "author_flair_richtext": [],
            "gildings": {},
            "content_categories": null,
            "is_self": true,
            "mod_note": null,
            "created": 1752790268,
            "link_flair_type": "richtext",
            "wls": 6,
            "removed_by_category": null,
            "banned_by": null,
            "author_flair_type": "text",
            "domain": "self.LocalLLaMA",
            "allow_live_comments": false,
            "selftext_html": "&lt;!-- SC_OFF --&gt;&lt;div class=\"md\"&gt;&lt;p&gt;[edit at the bottom cause i just had another thought]&lt;/p&gt;\n\n&lt;p&gt;I just finished my RAG pipeline and got everything wired together, but i’m finding that i didn’t think through decisions on when to call the retriever vs. when to just let the LLM answer. I’m curious, how do others who’ve implemented a RAG pipeline decide when to actually call it? &lt;/p&gt;\n\n&lt;p&gt;I started with just passing the prompt to a different model and saying some flavor of “decide if the below prompt requires RAG to answer or not” (with some better prompt engineering of course), but hardware is a big constraint for me at the moment so i’m trying to minimize LLM calls where i can. &lt;/p&gt;\n\n&lt;p&gt;After that, i tried manually defining rules around what goes where. I think i’ll still end up doing this to some extent at the end of the pipeline as a catch all based on words that i know will require RAG (like mention of domain specific words in the prompt) &lt;/p&gt;\n\n&lt;p&gt;Currently, i’m thinking i’ll just build a classification model that decides whether or not to call the RAG pipeline using few shot prompting. i’m currently working through a training dataset for this right now, but am realizing that this may be a ton of work for something that may ultimately have an easier solution. &lt;/p&gt;\n\n&lt;p&gt;[the new thought] instead of a classification model for whether or not to use rag, would it be smarter to use a classification model to tag &lt;em&gt;intention tagging&lt;/em&gt; and then use rag based off that? for example, intention tag = context:general-knowledge or intention tag = fact-finding:domain-knowledge or something like that&lt;/p&gt;\n\n&lt;p&gt;thoughts? &lt;/p&gt;\n&lt;/div&gt;&lt;!-- SC_ON --&gt;",
            "likes": null,
            "suggested_sort": null,
            "banned_at_utc": null,
            "view_count": null,
            "archived": false,
            "no_follow": false,
            "is_crosspostable": false,
            "pinned": false,
            "over_18": false,
            "all_awardings": [],
            "awarders": [],
            "media_only": false,
            "link_flair_template_id": "5f921ea4-c7bc-11ed-9c23-3a00622979b4",
            "can_gild": false,
            "spoiler": false,
            "locked": false,
            "author_flair_text": null,
            "treatment_tags": [],
            "visited": false,
            "removed_by": null,
            "num_reports": null,
            "distinguished": null,
            "subreddit_id": "t5_81eyvm",
            "author_is_blocked": false,
            "mod_reason_by": null,
            "removal_reason": null,
            "link_flair_background_color": "#646d73",
            "id": "1m2kz44",
            "is_robot_indexable": true,
            "num_duplicates": 0,
            "report_reasons": null,
            "author": "Loud-Bake-2740",
            "discussion_type": null,
            "num_comments": 6,
            "send_replies": true,
            "media": null,
            "contest_mode": false,
            "author_patreon_flair": false,
            "author_flair_text_color": null,
            "permalink": "/r/LocalLLaMA/comments/1m2kz44/when_to_rag/",
            "stickied": false,
            "url": "https://www.reddit.com/r/LocalLLaMA/comments/1m2kz44/when_to_rag/",
            "subreddit_subscribers": 501104,
            "created_utc": 1752790268,
            "num_crossposts": 0,
            "mod_reports": [],
            "is_video": false
          }
        }
      ],
      "before": null
    }
  },
  {
    "kind": "Listing",
    "data": {
      "after": null,
      "dist": null,
      "modhash": "",
      "geo_filter": "",
      "children": [
        {
          "kind": "t1",
          "data": {
            "subreddit_id": "t5_81eyvm",
            "approved_at_utc": null,
            "author_is_blocked": false,
            "comment_type": null,
            "awarders": [],
            "mod_reason_by": null,
            "banned_by": null,
            "author_flair_type": "text",
            "total_awards_received": 0,
            "subreddit": "LocalLLaMA",
            "author_flair_template_id": null,
            "likes": null,
            "replies": "",
            "user_reports": [],
            "saved": false,
            "id": "n3r3tj7",
            "banned_at_utc": null,
            "mod_reason_title": null,
            "gilded": 0,
            "archived": false,
            "collapsed_reason_code": null,
            "no_follow": true,
            "author": "SkyFeistyLlama8",
            "can_mod_post": false,
            "created_utc": 1752808490,
            "send_replies": true,
            "parent_id": "t3_1m2kz44",
            "score": 1,
            "author_fullname": "t2_1hgbaqgbnq",
            "approved_by": null,
            "mod_note": null,
            "all_awardings": [],
            "collapsed": false,
            "body": "Tool calling maybe? But you need to be very specific with what queries will run the RAG tool.",
            "edited": false,
            "top_awarded_type": null,
            "author_flair_css_class": null,
            "name": "t1_n3r3tj7",
            "is_submitter": false,
            "downs": 0,
            "author_flair_richtext": [],
            "author_patreon_flair": false,
            "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Tool calling maybe? But you need to be very specific with what queries will run the RAG tool.&lt;/p&gt;\n&lt;/div&gt;",
            "removal_reason": null,
            "collapsed_reason": null,
            "distinguished": null,
            "associated_award": null,
            "stickied": false,
            "author_premium": false,
            "can_gild": false,
            "gildings": {},
            "unrepliable_reason": null,
            "author_flair_text_color": null,
            "score_hidden": false,
            "permalink": "/r/LocalLLaMA/comments/1m2kz44/when_to_rag/n3r3tj7/",
            "subreddit_type": "public",
            "locked": false,
            "report_reasons": null,
            "created": 1752808490,
            "author_flair_text": null,
            "treatment_tags": [],
            "link_id": "t3_1m2kz44",
            "subreddit_name_prefixed": "r/LocalLLaMA",
            "controversiality": 0,
            "depth": 0,
            "author_flair_background_color": null,
            "collapsed_because_crowd_control": null,
            "mod_reports": [],
            "num_reports": null,
            "ups": 1
          }
        },
        {
          "kind": "t1",
          "data": {
            "subreddit_id": "t5_81eyvm",
            "approved_at_utc": null,
            "author_is_blocked": false,
            "comment_type": null,
            "awarders": [],
            "mod_reason_by": null,
            "banned_by": null,
            "author_flair_type": "text",
            "total_awards_received": 0,
            "subreddit": "LocalLLaMA",
            "author_flair_template_id": null,
            "likes": null,
            "replies": {
              "kind": "Listing",
              "data": {
                "after": null,
                "dist": null,
                "modhash": "",
                "geo_filter": "",
                "children": [
                  {
                    "kind": "t1",
                    "data": {
                      "subreddit_id": "t5_81eyvm",
                      "approved_at_utc": null,
                      "author_is_blocked": false,
                      "comment_type": null,
                      "awarders": [],
                      "mod_reason_by": null,
                      "banned_by": null,
                      "author_flair_type": "text",
                      "total_awards_received": 0,
                      "subreddit": "LocalLLaMA",
                      "author_flair_template_id": null,
                      "likes": null,
                      "replies": "",
                      "user_reports": [],
                      "saved": false,
                      "id": "n3tkdnk",
                      "banned_at_utc": null,
                      "mod_reason_title": null,
                      "gilded": 0,
                      "archived": false,
                      "collapsed_reason_code": null,
                      "no_follow": true,
                      "author": "Loud-Bake-2740",
                      "can_mod_post": false,
                      "created_utc": 1752848293,
                      "send_replies": true,
                      "parent_id": "t1_n3ry2dc",
                      "score": 1,
                      "author_fullname": "t2_1op55876",
                      "removal_reason": null,
                      "approved_by": null,
                      "mod_note": null,
                      "all_awardings": [],
                      "body": "oh! this must be showing my lack of understanding of this concept. I did the same thing and created a very rich set of metadata for each chunk, and assumed that what you're describing would just be a sequential step in the process as opposed to a different approach altogether. I'll look into this more closely. Thank you :)",
                      "edited": false,
                      "top_awarded_type": null,
                      "author_flair_css_class": null,
                      "name": "t1_n3tkdnk",
                      "is_submitter": true,
                      "downs": 0,
                      "author_flair_richtext": [],
                      "author_patreon_flair": false,
                      "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;oh! this must be showing my lack of understanding of this concept. I did the same thing and created a very rich set of metadata for each chunk, and assumed that what you&amp;#39;re describing would just be a sequential step in the process as opposed to a different approach altogether. I&amp;#39;ll look into this more closely. Thank you :)&lt;/p&gt;\n&lt;/div&gt;",
                      "gildings": {},
                      "collapsed_reason": null,
                      "distinguished": null,
                      "associated_award": null,
                      "stickied": false,
                      "author_premium": false,
                      "can_gild": false,
                      "link_id": "t3_1m2kz44",
                      "unrepliable_reason": null,
                      "author_flair_text_color": null,
                      "score_hidden": false,
                      "permalink": "/r/LocalLLaMA/comments/1m2kz44/when_to_rag/n3tkdnk/",
                      "subreddit_type": "public",
                      "locked": false,
                      "report_reasons": null,
                      "created": 1752848293,
                      "author_flair_text": null,
                      "treatment_tags": [],
                      "collapsed": false,
                      "subreddit_name_prefixed": "r/LocalLLaMA",
                      "controversiality": 0,
                      "depth": 1,
                      "author_flair_background_color": null,
                      "collapsed_because_crowd_control": null,
                      "mod_reports": [],
                      "num_reports": null,
                      "ups": 1
                    }
                  }
                ],
                "before": null
              }
            },
            "user_reports": [],
            "saved": false,
            "id": "n3ry2dc",
            "banned_at_utc": null,
            "mod_reason_title": null,
            "gilded": 0,
            "archived": false,
            "collapsed_reason_code": null,
            "no_follow": true,
            "author": "iamnotapuck",
            "can_mod_post": false,
            "created_utc": 1752822837,
            "send_replies": true,
            "parent_id": "t3_1m2kz44",
            "score": 1,
            "author_fullname": "t2_dyna1211",
            "approved_by": null,
            "mod_note": null,
            "all_awardings": [],
            "collapsed": false,
            "body": "I’ve had similar issues in the past, but I’ve migrated to a metadata embedding for my documents. This makes my vector database smaller and easier for retrieval. But it also requires pre-processing with a LLM of all the documents. So there are trade offs. \n\nBut having a json file of metadata of each document, segments of documents, that provide key words, dates, summaries, etc allows for easier retrieval during RAG/CAG without having to ingest a full document. \n\nThis then allows, at least in my pipeline, less LLM requests to an extent since I can do a simple search of the database, get the relevant metadata that points me to the right documents. Without having to query the LLM.",
            "edited": false,
            "top_awarded_type": null,
            "author_flair_css_class": null,
            "name": "t1_n3ry2dc",
            "is_submitter": false,
            "downs": 0,
            "author_flair_richtext": [],
            "author_patreon_flair": false,
            "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;I’ve had similar issues in the past, but I’ve migrated to a metadata embedding for my documents. This makes my vector database smaller and easier for retrieval. But it also requires pre-processing with a LLM of all the documents. So there are trade offs. &lt;/p&gt;\n\n&lt;p&gt;But having a json file of metadata of each document, segments of documents, that provide key words, dates, summaries, etc allows for easier retrieval during RAG/CAG without having to ingest a full document. &lt;/p&gt;\n\n&lt;p&gt;This then allows, at least in my pipeline, less LLM requests to an extent since I can do a simple search of the database, get the relevant metadata that points me to the right documents. Without having to query the LLM.&lt;/p&gt;\n&lt;/div&gt;",
            "removal_reason": null,
            "collapsed_reason": null,
            "distinguished": null,
            "associated_award": null,
            "stickied": false,
            "author_premium": false,
            "can_gild": false,
            "gildings": {},
            "unrepliable_reason": null,
            "author_flair_text_color": null,
            "score_hidden": false,
            "permalink": "/r/LocalLLaMA/comments/1m2kz44/when_to_rag/n3ry2dc/",
            "subreddit_type": "public",
            "locked": false,
            "report_reasons": null,
            "created": 1752822837,
            "author_flair_text": null,
            "treatment_tags": [],
            "link_id": "t3_1m2kz44",
            "subreddit_name_prefixed": "r/LocalLLaMA",
            "controversiality": 0,
            "depth": 0,
            "author_flair_background_color": null,
            "collapsed_because_crowd_control": null,
            "mod_reports": [],
            "num_reports": null,
            "ups": 1
          }
        },
        {
          "kind": "t1",
          "data": {
            "subreddit_id": "t5_81eyvm",
            "approved_at_utc": null,
            "author_is_blocked": false,
            "comment_type": null,
            "awarders": [],
            "mod_reason_by": null,
            "banned_by": null,
            "author_flair_type": "text",
            "total_awards_received": 0,
            "subreddit": "LocalLLaMA",
            "author_flair_template_id": null,
            "likes": null,
            "replies": {
              "kind": "Listing",
              "data": {
                "after": null,
                "dist": null,
                "modhash": "",
                "geo_filter": "",
                "children": [
                  {
                    "kind": "t1",
                    "data": {
                      "subreddit_id": "t5_81eyvm",
                      "approved_at_utc": null,
                      "author_is_blocked": false,
                      "comment_type": null,
                      "awarders": [],
                      "mod_reason_by": null,
                      "banned_by": null,
                      "author_flair_type": "text",
                      "total_awards_received": 0,
                      "subreddit": "LocalLLaMA",
                      "author_flair_template_id": null,
                      "likes": null,
                      "replies": {
                        "kind": "Listing",
                        "data": {
                          "after": null,
                          "dist": null,
                          "modhash": "",
                          "geo_filter": "",
                          "children": [
                            {
                              "kind": "t1",
                              "data": {
                                "subreddit_id": "t5_81eyvm",
                                "approved_at_utc": null,
                                "author_is_blocked": false,
                                "comment_type": null,
                                "awarders": [],
                                "mod_reason_by": null,
                                "banned_by": null,
                                "author_flair_type": "text",
                                "total_awards_received": 0,
                                "subreddit": "LocalLLaMA",
                                "author_flair_template_id": null,
                                "likes": null,
                                "replies": "",
                                "user_reports": [],
                                "saved": false,
                                "id": "n3q8u6r",
                                "banned_at_utc": null,
                                "mod_reason_title": null,
                                "gilded": 0,
                                "archived": false,
                                "collapsed_reason_code": null,
                                "no_follow": true,
                                "author": "HypnoDaddy4You",
                                "can_mod_post": false,
                                "send_replies": true,
                                "parent_id": "t1_n3pyg94",
                                "score": 0,
                                "author_fullname": "t2_lb2n7mbsw",
                                "removal_reason": null,
                                "approved_by": null,
                                "mod_note": null,
                                "all_awardings": [],
                                "body": "Then just always include the RAG results? I've done that in the past and the results aren't bad...\n\nMy real dilemma lately has been deciding how many documents to include. Some questions seem to require more than others...",
                                "edited": false,
                                "top_awarded_type": null,
                                "downs": 0,
                                "author_flair_css_class": null,
                                "name": "t1_n3q8u6r",
                                "is_submitter": false,
                                "collapsed": false,
                                "author_flair_richtext": [],
                                "author_patreon_flair": false,
                                "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;Then just always include the RAG results? I&amp;#39;ve done that in the past and the results aren&amp;#39;t bad...&lt;/p&gt;\n\n&lt;p&gt;My real dilemma lately has been deciding how many documents to include. Some questions seem to require more than others...&lt;/p&gt;\n&lt;/div&gt;",
                                "gildings": {},
                                "collapsed_reason": null,
                                "distinguished": null,
                                "associated_award": null,
                                "stickied": false,
                                "author_premium": false,
                                "can_gild": false,
                                "link_id": "t3_1m2kz44",
                                "unrepliable_reason": null,
                                "author_flair_text_color": null,
                                "score_hidden": false,
                                "permalink": "/r/LocalLLaMA/comments/1m2kz44/when_to_rag/n3q8u6r/",
                                "subreddit_type": "public",
                                "locked": false,
                                "report_reasons": null,
                                "created": 1752797136,
                                "author_flair_text": null,
                                "treatment_tags": [],
                                "created_utc": 1752797136,
                                "subreddit_name_prefixed": "r/LocalLLaMA",
                                "controversiality": 0,
                                "depth": 2,
                                "author_flair_background_color": null,
                                "collapsed_because_crowd_control": null,
                                "mod_reports": [],
                                "num_reports": null,
                                "ups": 0
                              }
                            }
                          ],
                          "before": null
                        }
                      },
                      "user_reports": [],
                      "saved": false,
                      "id": "n3pyg94",
                      "banned_at_utc": null,
                      "mod_reason_title": null,
                      "gilded": 0,
                      "archived": false,
                      "collapsed_reason_code": null,
                      "no_follow": true,
                      "author": "Loud-Bake-2740",
                      "can_mod_post": false,
                      "created_utc": 1752793624,
                      "send_replies": true,
                      "parent_id": "t1_n3puakz",
                      "score": 1,
                      "author_fullname": "t2_1op55876",
                      "removal_reason": null,
                      "approved_by": null,
                      "mod_note": null,
                      "all_awardings": [],
                      "body": "wouldn’t this still just be an llm call though? that’s what i’m trying to avoid",
                      "edited": false,
                      "top_awarded_type": null,
                      "author_flair_css_class": null,
                      "name": "t1_n3pyg94",
                      "is_submitter": true,
                      "downs": 0,
                      "author_flair_richtext": [],
                      "author_patreon_flair": false,
                      "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;wouldn’t this still just be an llm call though? that’s what i’m trying to avoid&lt;/p&gt;\n&lt;/div&gt;",
                      "gildings": {},
                      "collapsed_reason": null,
                      "distinguished": null,
                      "associated_award": null,
                      "stickied": false,
                      "author_premium": false,
                      "can_gild": false,
                      "link_id": "t3_1m2kz44",
                      "unrepliable_reason": null,
                      "author_flair_text_color": null,
                      "score_hidden": false,
                      "permalink": "/r/LocalLLaMA/comments/1m2kz44/when_to_rag/n3pyg94/",
                      "subreddit_type": "public",
                      "locked": false,
                      "report_reasons": null,
                      "created": 1752793624,
                      "author_flair_text": null,
                      "treatment_tags": [],
                      "collapsed": false,
                      "subreddit_name_prefixed": "r/LocalLLaMA",
                      "controversiality": 0,
                      "depth": 1,
                      "author_flair_background_color": null,
                      "collapsed_because_crowd_control": null,
                      "mod_reports": [],
                      "num_reports": null,
                      "ups": 1
                    }
                  }
                ],
                "before": null
              }
            },
            "user_reports": [],
            "saved": false,
            "id": "n3puakz",
            "banned_at_utc": null,
            "mod_reason_title": null,
            "gilded": 0,
            "archived": false,
            "collapsed_reason_code": null,
            "no_follow": true,
            "author": "HypnoDaddy4You",
            "can_mod_post": false,
            "created_utc": 1752792264,
            "send_replies": true,
            "parent_id": "t3_1m2kz44",
            "score": 0,
            "author_fullname": "t2_lb2n7mbsw",
            "approved_by": null,
            "mod_note": null,
            "all_awardings": [],
            "collapsed": false,
            "body": "You can use a thinking model to suggest various related search terms. You just have to explain to it how rag works in your prompt.",
            "edited": false,
            "top_awarded_type": null,
            "author_flair_css_class": null,
            "name": "t1_n3puakz",
            "is_submitter": false,
            "downs": 0,
            "author_flair_richtext": [],
            "author_patreon_flair": false,
            "body_html": "&lt;div class=\"md\"&gt;&lt;p&gt;You can use a thinking model to suggest various related search terms. You just have to explain to it how rag works in your prompt.&lt;/p&gt;\n&lt;/div&gt;",
            "removal_reason": null,
            "collapsed_reason": null,
            "distinguished": null,
            "associated_award": null,
            "stickied": false,
            "author_premium": false,
            "can_gild": false,
            "gildings": {},
            "unrepliable_reason": null,
            "author_flair_text_color": null,
            "score_hidden": false,
            "permalink": "/r/LocalLLaMA/comments/1m2kz44/when_to_rag/n3puakz/",
            "subreddit_type": "public",
            "locked": false,
            "report_reasons": null,
            "created": 1752792264,
            "author_flair_text": null,
            "treatment_tags": [],
            "link_id": "t3_1m2kz44",
            "subreddit_name_prefixed": "r/LocalLLaMA",
            "controversiality": 0,
            "depth": 0,
            "author_flair_background_color": null,
            "collapsed_because_crowd_control": null,
            "mod_reports": [],
            "num_reports": null,
            "ups": 0
          }
        }
      ],
      "before": null
    }
  }
]